<div class="container-fluid py-3">
  <!-- Cards -->
  <div class="row g-3">
    <div class="col-md-4" *ngFor="let c of cards">
      <div class="card card-click h-100" (click)="abrirModal(c)">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div class="fw-bold">{{ c.titulo }}</div>
              <div class="small text-muted">{{ c.subtitulo }}</div>
            </div>

            <span class="badge bg-dark">{{ countCard(c.id) }}</span>
          </div>

          <div class="mt-3 small text-muted">
            Clique para abrir o kanban completo
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal (Bootstrap style, controlado via Angular) -->
  <div class="modal fade show" *ngIf="modalAberto" style="display: block;" (click)="fecharModal()">
    <div class="modal-dialog modal-xl modal-dialog-centered" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title mb-0">{{ cardSelecionado?.titulo }}</h5>
            <div class="small text-muted">{{ cardSelecionado?.subtitulo }}</div>
          </div>

          <button type="button" class="btn-close" aria-label="Close" (click)="fecharModal()"></button>
        </div>

        <div class="modal-body">
          <!-- Kanban -->
          <div class="row g-3">
            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header fw-bold d-flex justify-content-between">
                  <span>Pendente</span>
                  <span class="badge bg-secondary">{{ pendentesModal.length }}</span>
                </div>
                <div class="card-body kanban-col">
                  <div *ngIf="pendentesModal.length === 0" class="text-muted small">Sem itens</div>

                  <div class="task" *ngFor="let t of pendentesModal">
                    <div class="fw-bold">{{ t.titulo }}</div>
                    <div class="small text-muted" *ngIf="t.descricao">{{ t.descricao }}</div>
                    <div class="d-flex gap-2 mt-2 align-items-center">
                      <span class="badge" [class]="prioridadeBadgeClass(t.prioridade)">{{ t.prioridade }}</span>
                      <span class="small text-muted" *ngIf="t.responsavel">{{ t.responsavel }}</span>
                      <span class="small text-muted" *ngIf="t.prazo">• {{ t.prazo }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header fw-bold d-flex justify-content-between">
                  <span>Em andamento</span>
                  <span class="badge bg-warning text-dark">{{ andamentoModal.length }}</span>
                </div>
                <div class="card-body kanban-col">
                  <div *ngIf="andamentoModal.length === 0" class="text-muted small">Sem itens</div>

                  <div class="task" *ngFor="let t of andamentoModal">
                    <div class="fw-bold">{{ t.titulo }}</div>
                    <div class="small text-muted" *ngIf="t.descricao">{{ t.descricao }}</div>
                    <div class="d-flex gap-2 mt-2 align-items-center">
                      <span class="badge" [class]="prioridadeBadgeClass(t.prioridade)">{{ t.prioridade }}</span>
                      <span class="small text-muted" *ngIf="t.responsavel">{{ t.responsavel }}</span>
                      <span class="small text-muted" *ngIf="t.prazo">• {{ t.prazo }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card h-100">
                <div class="card-header fw-bold d-flex justify-content-between">
                  <span>Concluído</span>
                  <span class="badge bg-success">{{ concluidasModal.length }}</span>
                </div>
                <div class="card-body kanban-col">
                  <div *ngIf="concluidasModal.length === 0" class="text-muted small">Sem itens</div>

                  <div class="task" *ngFor="let t of concluidasModal">
                    <div class="fw-bold">{{ t.titulo }}</div>
                    <div class="small text-muted" *ngIf="t.descricao">{{ t.descricao }}</div>
                    <div class="d-flex gap-2 mt-2 align-items-center">
                      <span class="badge" [class]="prioridadeBadgeClass(t.prioridade)">{{ t.prioridade }}</span>
                      <span class="small text-muted" *ngIf="t.responsavel">{{ t.responsavel }}</span>
                      <span class="small text-muted" *ngIf="t.prazo">• {{ t.prazo }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- /Kanban -->
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="fecharModal()">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Backdrop -->
  <div class="modal-backdrop fade show" *ngIf="modalAberto"></div>
</div>
